<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ToDo App - Phase2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container py-4">

  <h1 class="mb-4">ToDo ã‚¢ãƒ—ãƒªï¼ˆPhase 2ï¼‰</h1>

  <a href="{{ url_for('task_list') }}" class="btn btn-outline-primary mb-4">
    ğŸ“‹ ã‚¿ã‚¹ã‚¯ä¸€è¦§ãƒšãƒ¼ã‚¸ã¸
  </a>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="mb-3">
        {% for msg in messages %}
          <div class="alert alert-info">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="row">

    <!-- æ–°è¦ç™»éŒ² -->
    <div class="col-md-6">
      <h4>æ–°è¦ã‚¿ã‚¹ã‚¯ç™»éŒ²</h4>

      <form action="{{ url_for('add') }}" method="post">
        <div class="mb-2">
          <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
          <input class="form-control" name="title" required>
        </div>

        <div class="mb-2">
          <label class="form-label">å†…å®¹</label>
          <textarea class="form-control" name="content" rows="3"></textarea>
        </div>

        <div class="mb-2">
          <label class="form-label">æœŸæ—¥ï¼ˆæ—¥æ™‚ï¼‰</label>
          <input class="form-control" type="datetime-local" name="duedate" required>
        </div>

        <div class="mb-2">
          <label class="form-label">ã‚«ãƒ†ã‚´ãƒª</label>
          <select class="form-select" name="category">
            <option value="">æœªåˆ†é¡</option>
            <option value="ä»•äº‹">ä»•äº‹</option>
            <option value="å®¶åº­">å®¶åº­</option>
            <option value="å­¦ç¿’">å­¦ç¿’</option>
          </select>
        </div>

        <div class="mb-2">
          <label class="form-label">å„ªå…ˆåº¦</label>
          <select class="form-select" name="priority">
            <option value="é«˜">é«˜</option>
            <option value="ä¸­" selected>ä¸­</option>
            <option value="ä½">ä½</option>
          </select>
        </div>

        <button class="btn btn-primary mt-2">ç™»éŒ²</button>
      </form>
    </div>

    <!-- ä¸€è¦§ -->
    <div class="col-md-6">
      <h4>ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼ˆæœŸæ—¥ãŒè¿‘ã„é †ï¼‰</h4>

      <table class="table table-sm table-bordered bg-white align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:50px;">å®Œäº†</th>
            <th>ã‚«ãƒ†ã‚´ãƒª</th>
            <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
            <th>å„ªå…ˆåº¦</th>
            <th>æœŸæ—¥</th>
            <th>ç·¨é›†</th>
            <th>å‰Šé™¤</th>
          </tr>
        </thead>

        <tbody>
        {% for t in tasks %}
          {% set is_overdue = (not t.Completed) and t._due and t._due < now %}
          {% set days_left = (t._due.date() - now.date()).days if t._due else None %}

          <tr class="{% if is_overdue %}table-danger{% elif t.Completed %}table-secondary{% endif %}">

            <!-- å®Œäº† -->
            <td class="text-center">
              <form action="{{ url_for('toggle', task_id=t.ID) }}" method="post">
                <input type="checkbox" class="form-check-input"
                       onchange="this.form.submit()"
                       {% if t.Completed %}checked{% endif %}>
              </form>
            </td>

            <!-- ã‚«ãƒ†ã‚´ãƒª -->
            <td class="text-center fs-5">
              {% if t.Category == "ä»•äº‹" %}ğŸ’¼
              {% elif t.Category == "å®¶åº­" %}ğŸ 
              {% elif t.Category == "å­¦ç¿’" %}ğŸ““
              {% else %}ğŸ“Œ
              {% endif %}
            </td>

            <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
            <td>
              {% if t.Completed %}
                <del class="text-muted">{{ t.Title }}</del>
              {% else %}
                {{ t.Title }}
              {% endif %}
            </td>

            <!-- å„ªå…ˆåº¦ -->
            <td class="text-center">
              {% if t.Priority == "é«˜" %}
                <span class="badge bg-danger">é«˜</span>
              {% elif t.Priority == "ä¸­" %}
                <span class="badge bg-warning text-dark">ä¸­</span>
              {% else %}
                <span class="badge bg-secondary">ä½</span>
              {% endif %}
            </td>

            <!-- æœŸæ—¥ï¼ˆçµ±ä¸€ãƒ»æ”¹å–„ç‰ˆï¼‰ -->
            <td>
              {% if not t._due %}
                â€”
              {% elif days_left < 0 %}
                <span class="fw-bold text-danger">
                  {{ t._due.strftime("%m/%d %H:%M") }}
                </span>
              {% elif days_left == 0 %}
                <span class="fw-bold text-danger">
                  ä»Šæ—¥ {{ t._due.strftime("%H:%M") }}ã¾ã§
                </span>
              {% elif days_left == 1 %}
                <span class="fw-bold text-warning">
                  æ˜æ—¥ {{ t._due.strftime("%H:%M") }}ã¾ã§
                </span>
              {% else %}
                {% if t._due.year != now.year %}
                  {{ t._due.strftime("%Y/%m/%d %H:%M") }}
                {% else %}
                  {{ t._due.strftime("%m/%d %H:%M") }}
                {% endif %}
                <br>
                <small class="
                  {% if days_left <= 3 %}text-warning
                  {% elif days_left <= 7 %}text-success
                  {% else %}text-muted
                  {% endif %}
                ">
                  ã‚ã¨{{ days_left }}æ—¥
                </small>
              {% endif %}
            </td>

            <!-- ç·¨é›† -->
            <td>
              <a class="btn btn-sm btn-outline-secondary"
                 href="{{ url_for('edit', task_id=t.ID) }}">
                ç·¨é›†
              </a>
            </td>

            <!-- å‰Šé™¤ -->
            <td>
              <form action="{{ url_for('delete', task_id=t.ID) }}"
                    method="post"
                    onsubmit="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                <button class="btn btn-sm btn-danger">
                  å‰Šé™¤
                </button>
              </form>
            </td>

          </tr>
        {% else %}
          <tr>
            <td colspan="7" class="text-center text-muted">
              ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <small class="text-muted">
        ğŸ”´ æœŸé™åˆ‡ã‚Œ ï¼ ä»Šæ—¥ãƒ»æ˜æ—¥ã¯å¼·èª¿  
        ï½œ ğŸ’¼ä»•äº‹ ğŸ å®¶åº­ ğŸ““å­¦ç¿’  
        ï½œ ğŸ”¥ é«˜ â†’ ä¸­ â†’ ä½
      </small>
    </div>

  </div>
</div>
</body>
</html>
