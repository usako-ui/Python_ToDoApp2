<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ã‚¿ã‚¹ã‚¯ä¸€è¦§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container py-4">

  <h1 class="mb-4">ã‚¿ã‚¹ã‚¯ä¸€è¦§</h1>

  <!-- æˆ»ã‚‹ -->
  <a class="btn btn-secondary mb-3" href="{{ url_for('index') }}">
    â† ç™»éŒ²ç”»é¢ã¸æˆ»ã‚‹
  </a>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ï¼šçŠ¶æ…‹ -->
  <div class="mb-2">
    <strong>è¡¨ç¤ºï¼š</strong>
    <a class="btn btn-outline-primary btn-sm"
       href="{{ url_for('task_list') }}">
      å…¨ä»¶
    </a>
    <a class="btn btn-outline-primary btn-sm"
       href="{{ url_for('task_list', filter='todo') }}">
      æœªå®Œäº†ã®ã¿
    </a>
  </div>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ï¼šã‚«ãƒ†ã‚´ãƒª -->
  <div class="mb-2">
    <strong>ã‚«ãƒ†ã‚´ãƒªï¼š</strong>
    <a class="btn btn-outline-secondary btn-sm"
       href="{{ url_for('task_list', category='ä»•äº‹') }}">ğŸ’¼ ä»•äº‹</a>
    <a class="btn btn-outline-secondary btn-sm"
       href="{{ url_for('task_list', category='å®¶åº­') }}">ğŸ  å®¶åº­</a>
    <a class="btn btn-outline-secondary btn-sm"
       href="{{ url_for('task_list', category='å­¦ç¿’') }}">ğŸ““ å­¦ç¿’</a>
  </div>

  <!-- ä¸¦ã³æ›¿ãˆ -->
  <div class="mb-3">
    <strong>ä¸¦ã³æ›¿ãˆï¼š</strong>
    <a class="btn btn-outline-dark btn-sm"
       href="{{ url_for('task_list', sort='due') }}">
      ğŸ“… æœŸæ—¥é †
    </a>
    <a class="btn btn-outline-dark btn-sm"
       href="{{ url_for('task_list', sort='priority') }}">
      ğŸ”¥ å„ªå…ˆåº¦é †
    </a>
  </div>

  <!-- å®Œäº†ã‚¿ã‚¹ã‚¯ä¸€æ‹¬å‰Šé™¤ -->
  <form action="{{ url_for('delete_completed') }}"
        method="post"
        onsubmit="return confirm('å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');"
        class="mb-3">
    <button class="btn btn-danger btn-sm">
      âœ” å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ã‚’ä¸€æ‹¬å‰Šé™¤
    </button>
  </form>

  <table class="table table-sm table-bordered bg-white align-middle">
    <thead class="table-light">
      <tr>
        <th style="width:50px;">å®Œäº†</th>
        <th>ã‚«ãƒ†ã‚´ãƒª</th>
        <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
        <th>å„ªå…ˆåº¦</th>
        <th>æœŸæ—¥</th>
        <th>ç·¨é›†</th>
        <th>å‰Šé™¤</th>
      </tr>
    </thead>

    <tbody>
      {% for t in tasks %}
        {% set is_overdue = (not t.Completed) and t._due and t._due < now %}
        {% set days_left = (t._due.date() - now.date()).days if t._due else None %}
        <tr class="{% if is_overdue %}table-danger{% elif t.Completed %}table-secondary{% endif %}">

          <!-- å®Œäº† -->
          <td class="text-center">
            <form action="{{ url_for('toggle', task_id=t.ID) }}" method="post">
              <input type="checkbox"
                     class="form-check-input"
                     onchange="this.form.submit()"
                     {% if t.Completed %}checked{% endif %}>
            </form>
          </td>

          <!-- ã‚«ãƒ†ã‚´ãƒª -->
          <td class="text-center fs-5">
            {% if t.Category == "ä»•äº‹" %}ğŸ’¼
            {% elif t.Category == "å®¶åº­" %}ğŸ 
            {% elif t.Category == "å­¦ç¿’" %}ğŸ““
            {% else %}ğŸ“Œ
            {% endif %}
          </td>

          <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
          <td>
            {% if t.Completed %}
              <del class="text-muted">{{ t.Title }}</del>
            {% else %}
              {{ t.Title }}
            {% endif %}
          </td>

          <!-- å„ªå…ˆåº¦ -->
          <td class="text-center">
            {% if t.Priority == "é«˜" %}
              <span class="badge bg-danger">é«˜</span>
            {% elif t.Priority == "ä¸­" %}
              <span class="badge bg-warning text-dark">ä¸­</span>
            {% else %}
              <span class="badge bg-secondary">ä½</span>
            {% endif %}
          </td>

          <!-- â˜… æ”¹å–„æ¸ˆã¿ï¼šæœŸæ—¥è¡¨ç¤º -->
          <td>
            {% if not t._due %}
              â€”
            {% elif days_left == 0 %}
              <span class="fw-bold text-danger">ä»Šæ—¥ {{ t._due.strftime("%H:%M") }}ã¾ã§</span>
            {% elif days_left == 1 %}
              <span class="fw-bold text-warning">æ˜æ—¥ {{ t._due.strftime("%H:%M") }}ã¾ã§</span>
            {% else %}
              {% if t._due.year != now.year %}
                {{ t._due.strftime("%Y/%m/%d %H:%M") }}
              {% else %}
                {{ t._due.strftime("%m/%d %H:%M") }}
              {% endif %}
              <br>
              <small class="text-muted">
                ã‚ã¨{{ days_left }}æ—¥
              </small>
            {% endif %}
          </td>

          <!-- ç·¨é›† -->
          <td>
            <a class="btn btn-sm btn-outline-secondary"
               href="{{ url_for('edit', task_id=t.ID) }}">
              ç·¨é›†
            </a>
          </td>

          <!-- å‰Šé™¤ -->
          <td>
            <form action="{{ url_for('delete', task_id=t.ID) }}"
                  method="post"
                  onsubmit="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
              <button class="btn btn-sm btn-danger">
                å‰Šé™¤
              </button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="7" class="text-center text-muted">
            ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <small class="text-muted">
    ğŸ”´ èµ¤ï¼šæœŸé™åˆ‡ã‚Œ ï¼ ä»Šæ—¥ãƒ»æ˜æ—¥ã¯å¼·èª¿è¡¨ç¤º  
    ï½œ ğŸ’¼ä»•äº‹ ğŸ å®¶åº­ ğŸ““å­¦ç¿’  
    ï½œ ğŸ”¥ é«˜ â†’ ä¸­ â†’ ä½
  </small>

</div>
</body>
</html>
